const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/serverMap_fix-myFI28f_.js","assets/sleep-CijeuSbY.js"])))=>i.map(i=>d[i]);
import{_ as T}from"./app-DsdG2T57.js";import{c as L,b as O,a as V,u as K,d as R}from"./urlAddParam-N3jyhG-I.js";import{d as y,f as $,a as c,o as N,I as w,h as j,j as g,k as a,t as k,u as b,J as z,H as E,q,F as J,n as H,B as X,K as G,p as Q,L as W}from"./virtual_svg-icons-register-B6YRyGTZ.js";async function Y(p,n=void 0){{const s=L();if(s!=null)return s}try{const s=await fetch(`${O}${p}`,{method:"POST",headers:{"X-API-Key":V,"Content-Type":"application/json"},body:JSON.stringify(n||{})});return{code:0,result:{ok:s.ok,json:await s.json(),statusCode:s.status}}}catch{return{code:4}}}const Z={class:"card-header d-flex justify-content-center"},ee={class:"card-body"},te={class:"input-group"},ae={class:"input-group-text"},se=["placeholder"],ne={class:"input-group d-flex justify-content-evenly mt-1"},oe={class:"form-check form-switch"},re={class:"form-check-label"},le={class:"form-check form-switch"},ue={class:"form-check-label"},C=y({__name:"passwordInput",props:{savePassword:{type:Object,default:null}},emits:["passwdEnter"],setup(p,{expose:n,emit:s}){const{lt:r}=$(),d=s,e=p,v=c(null),u=c(null),m=c(!1),l=c(null),t=c(null),o=c(null),f=c(null),S=c("alert-secondary");function I(h,i,_=null){f.value&&(_==null?f.value.innerText=r(`feedback.${i}`):f.value.innerText=r(`feedback.${i}`,_),S.value=h,m.value=h=="alert-danger",f.value.style.display="")}function P(){u.value&&(u.value.value!=""?(d("passwdEnter",u.value.value),t.value&&e.savePassword!=null&&t.value.checked&&w().set(`passwordInput.${e.savePassword.cookie.name}.savePassword.value`,u.value.value,{path:e.savePassword.cookie.path,secure:!0,sameSite:"none",maxAge:2592e3})):I("alert-danger",0))}function A(){e.savePassword!=null&&t.value&&w().set(`passwordInput.${e.savePassword.cookie.name}.savePassword.enable`,t.value.checked,{path:e.savePassword.cookie.path})}function x(h=!0){e.savePassword!=null&&t.value&&o.value&&(o.value.checked?(t.value.disabled=!0,t.value.checked=!0):t.value.disabled=!1,h&&w().set(`passwordInput.${e.savePassword.cookie.name}.autoEnter`,o.value.checked,{path:e.savePassword.cookie.path}))}N(()=>{if(e.savePassword!=null){t.value.disabled=!1,o.value.disabled=!1;const h=w().get(`passwordInput.${e.savePassword.cookie.name}.savePassword.enable`),i=w().get(`passwordInput.${e.savePassword.cookie.name}.savePassword.value`),_=w().get(`passwordInput.${e.savePassword.cookie.name}.autoEnter`);i!=null&&(_==!0?(o.value.checked=!0,x(!1),u.value.value=i,P()):h==!0&&(t.value.checked=!0,u.value.value=i))}});function B(){return u.value&&l.value?(u.value.disabled=!0,l.value.disabled=!0,!0):!1}function U(){return u.value&&l.value?(u.value.disabled=!1,l.value.disabled=!1,!0):!1}function D(){return v.value?(v.value.style.display="none",!0):!1}function M(){return v.value?(v.value.style.display="",!0):!1}return n({showFeedback:I,lockInput:B,unlockInput:U,hidePanel:D,unhidePanel:M}),(h,i)=>(g(),j("div",{ref_key:"pswIptPanel",ref:v,class:"card"},[a("div",Z,[a("strong",null,k(b(r)("title")),1)]),a("div",ee,[a("div",te,[a("span",ae,k(b(r)("label")),1),a("input",{ref_key:"passwordInput",ref:u,type:"password",class:E(["form-control",{"is-invalid":m.value}]),placeholder:b(r)("inputText"),onKeyup:z(P,["enter"])},null,42,se),a("button",{class:"btn btn-outline-secondary",type:"button",ref_key:"enterButton",ref:l,onClick:P},k(b(r)("enterBtn")),513)]),a("div",ne,[a("div",oe,[a("input",{ref_key:"savePaswdSw",ref:t,onChange:i[0]||(i[0]=_=>A()),class:"form-check-input",type:"checkbox",role:"switch",disabled:""},null,544),a("label",re,k(b(r)("savePaswdSw")),1)]),a("div",le,[a("input",{ref_key:"autoEnterSw",ref:o,onChange:i[1]||(i[1]=_=>x()),class:"form-check-input",type:"checkbox",role:"switch",disabled:""},null,544),a("label",ue,k(b(r)("autoEnterSw")),1)])]),a("div",{ref_key:"feedback",ref:f,class:E(["alert mt-3 mb-0",[S.value]]),role:"alert",style:{display:"none"}},null,2)])],512))}});function F(p){const n=p;n.__i18n=n.__i18n||[],n.__i18n.push({locale:"",resource:{"zh-CN":{label:{t:0,b:{t:2,i:[{t:3}],s:"访问密码"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"进入"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"密码"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"密码不可为空"}},1:{t:0,b:{t:2,i:[{t:3}],s:"密码错误"}},2:{t:0,b:{t:2,i:[{t:3}],s:"无法连接至服务"}},3:{t:0,b:{t:2,i:[{t:3}],s:"验证成功，等待加载"}},4:{t:0,b:{t:2,i:[{t:3}],s:"正在验证"}},5:{t:0,b:{t:2,i:[{t:3,v:"密码错误次数过多，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}},6:{t:0,b:{t:2,i:[{t:4,k:"timeSec"},{t:3,v:"秒后再次尝试"}]}},7:{t:0,b:{t:2,i:[{t:3,v:"当前拒绝密码验证，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"访问限制内容"}},savePaswdSw:{t:0,b:{t:2,i:[{t:3}],s:"保存密码"}},autoEnterSw:{t:0,b:{t:2,i:[{t:3}],s:"自动进入"}}},"en-US":{label:{t:0,b:{t:2,i:[{t:3}],s:"Access Password"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"Enter"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"Password"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"Password cannot be empty"}},1:{t:0,b:{t:2,i:[{t:3}],s:"Incorrect password"}},2:{t:0,b:{t:2,i:[{t:3}],s:"Unable to connect to the service"}},3:{t:0,b:{t:2,i:[{t:3}],s:"Verification successful, waiting to load"}},4:{t:0,b:{t:2,i:[{t:3}],s:"Verifying"}},5:{t:0,b:{t:2,i:[{t:3,v:"Too many incorrect password attempts. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},6:{t:0,b:{t:2,i:[{t:3,v:"Try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},7:{t:0,b:{t:2,i:[{t:3,v:"Password verification is being refused. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"Restricted Content"}},savePaswdSw:{t:0,b:{t:2,i:[{t:3}],s:"Save Password"}},autoEnterSw:{t:0,b:{t:2,i:[{t:3}],s:"Auto Enter"}}}}})}typeof F=="function"&&F(C);const ie={id:"main"},ce={id:"authBox"},de={id:"mainTitle"},ve=y({__name:"AuthSubPage",props:{targetUrlPath:{type:String,required:!0},title:{type:String,default:""},other:{type:Object,default:{}},savePassword:{type:Object,default:null}},setup(p){const n=p,s=c(null);let r=!1;const d=c(null),e=c(null);function v(l){return((l instanceof Date?l:new Date(l)).getTime()-Date.now())/1e3}async function u(l){if(e.value){e.value.showFeedback("alert-secondary",4),e.value.lockInput();{const o=w().get("passwordAuthLockDown_unlockTime");if(o!=null){e.value.showFeedback("alert-danger",6,{timeSec:Math.round(v(o))}),e.value.unlockInput();return}}const t=await Y(n.targetUrlPath,{Password:l});if(t.result!=null)if(t.result.ok)e.value.showFeedback("alert-success",3),r=!0,s.value.src=K(t.result.json.url,{params:[{name:"passkey",value:t.result.json.paras.passkey},{name:"source",value:t.result.json.paras.source}]});else if(t.result.statusCode==401)switch(t.result.json.errorId){case 0:e.value.showFeedback("alert-danger",1),e.value.unlockInput();break;case 1:case 2:const o=t.result.json.unlockTime,f=Math.round(v(o));switch(t.result.json.errorId){case 1:e.value.showFeedback("alert-danger",5,{timeSec:f});break;case 2:e.value.showFeedback("alert-danger",7,{timeSec:f});break}e.value.unlockInput(),w().set("passwordAuthLockDown_unlockTime",o,{expires:new Date(o)});break}else e.value.showFeedback("alert-warning",2),e.value.unlockInput();else e.value.showFeedback("alert-warning",2),e.value.unlockInput()}}function m(){s.value&&d.value&&r&&(s.value.style.display="",d.value.style.display="none",n.other.doServerMapFix==!0&&(async()=>{const{sleep:l}=await T(async()=>{const{sleep:o}=await import("./sleep-CijeuSbY.js");return{sleep:o}},[]),t=(await T(async()=>{const{default:o}=await import("./serverMap_fix-myFI28f_.js");return{default:o}},__vite__mapDeps([0,1]))).default;await l(2600),await t()})())}return(l,t)=>(g(),j(J,null,[a("div",ie,[a("iframe",{ref_key:"mainIframe",ref:s,id:"mainIframe",src:"",onload:m,style:{display:"none"},allow:"fullscreen; pointer-lock;",webkitallowfullscreen:"true",mozallowfullscreen:"true"},null,512)]),a("div",{id:"authContainer",ref_key:"authContainer",ref:d},[a("div",ce,[a("h2",de,k(n.title),1),q(C,{ref_key:"passwordInput",ref:e,onPasswdEnter:u,savePassword:n.savePassword},null,8,["savePassword"])])],512)],64))}}),pe=H(ve,[["__scopeId","data-v-73c172e1"]]),he=y({__name:"ReuseParentSubPage",setup(p){const n=X(),s=G(()=>({authSubPage:{targetUrlPath:n.meta.authSubPage_targetUrlPath,savePassword:n.meta.authSubPage_savePassword,doServerMapFix:n.meta.authSubPage_doServerMapFix!=null?n.meta.authSubPage_doServerMapFix:!1},localePrefix:n.meta.localePrefix})),{gt:r}=$(),d=s.value.localePrefix;return Q(d,()=>{R(r(`${d}.title`))}),(e,v)=>(g(),W(pe,{targetUrlPath:s.value.authSubPage.targetUrlPath,title:b(r)(`${b(d)}.subTitle`),other:{doServerMapFix:s.value.authSubPage.doServerMapFix},savePassword:s.value.authSubPage.savePassword},null,8,["targetUrlPath","title","other","savePassword"]))}});export{he as default};
