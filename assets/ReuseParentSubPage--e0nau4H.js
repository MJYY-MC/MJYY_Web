const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/serverMap_fix-myFI28f_.js","assets/sleep-CijeuSbY.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./app-zkuED-OD.js";import{H as B,d as k,f as x,a as c,h as T,j as w,k as o,t as b,u as p,I as E,G as P,q as A,F as D,J as S,n as L,A as M,K as V,p as q,L as K}from"./virtual_svg-icons-register-B1TzvzS_.js";import{u as N}from"./index-BTU9scXs.js";const O="https://web.mjyy.top/server",R="5v2co487ycn7t8qorhntov584r7ghcqo45nv7ghqru4io75vyn";function z(d){return B?null:{code:3}}async function J(d,a=void 0){{const t=z();if(t!=null)return t}try{const t=await fetch(`${O}${d}`,{method:"POST",headers:{"X-API-Key":R,"Content-Type":"application/json"},body:JSON.stringify(a||{})});return{code:0,result:{ok:t.ok,json:await t.json(),statusCode:t.status}}}catch{return{code:4}}}const G={class:"card-header d-flex justify-content-center"},H={class:"card-body"},X={class:"input-group"},Q={class:"input-group-text"},W=["placeholder"],F=k({__name:"passwordInput",emits:["passwdEnter"],setup(d,{expose:a,emit:t}){const{lt:l}=x(),u=t,e=c(null),i=c(null),_=c(!1),f=c(null),n=c(null),s=c("alert-secondary");function r(h,m,y=null){n.value&&(y==null?n.value.innerText=l(`feedback.${m}`):n.value.innerText=l(`feedback.${m}`,y),s.value=h,_.value=h=="alert-danger",n.value.style.display="")}function v(){i.value&&(i.value.value!=""?u("passwdEnter",i.value.value):r("alert-danger",0))}function C(){return i.value&&f.value?(i.value.disabled=!0,f.value.disabled=!0,!0):!1}function $(){return i.value&&f.value?(i.value.disabled=!1,f.value.disabled=!1,!0):!1}function j(){return e.value?(e.value.style.display="none",!0):!1}function U(){return e.value?(e.value.style.display="",!0):!1}return a({showFeedback:r,lockInput:C,unlockInput:$,hidePanel:j,unhidePanel:U}),(h,m)=>(w(),T("div",{ref_key:"pswIptPanel",ref:e,class:"card"},[o("div",G,[o("strong",null,b(p(l)("title")),1)]),o("div",H,[o("div",X,[o("span",Q,b(p(l)("label")),1),o("input",{ref_key:"passwordInput",ref:i,type:"password",class:P(["form-control",{"is-invalid":_.value}]),placeholder:p(l)("inputText"),onKeyup:E(v,["enter"])},null,42,W),o("button",{class:"btn btn-outline-secondary",type:"button",ref_key:"enterButton",ref:f,onClick:v},b(p(l)("enterBtn")),513)]),o("div",{ref_key:"feedback",ref:n,class:P(["alert mt-3 mb-0",[s.value]]),role:"alert",style:{display:"none"}},null,2)])],512))}});function I(d){const a=d;a.__i18n=a.__i18n||[],a.__i18n.push({locale:"",resource:{"zh-CN":{label:{t:0,b:{t:2,i:[{t:3}],s:"访问密码"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"进入"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"密码"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"密码不可为空"}},1:{t:0,b:{t:2,i:[{t:3}],s:"密码错误"}},2:{t:0,b:{t:2,i:[{t:3}],s:"无法连接至服务"}},3:{t:0,b:{t:2,i:[{t:3}],s:"验证成功，等待加载"}},4:{t:0,b:{t:2,i:[{t:3}],s:"正在验证"}},5:{t:0,b:{t:2,i:[{t:3,v:"密码错误次数过多，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}},6:{t:0,b:{t:2,i:[{t:4,k:"timeSec"},{t:3,v:"秒后再次尝试"}]}},7:{t:0,b:{t:2,i:[{t:3,v:"当前拒绝密码验证，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"访问限制内容"}}},"en-US":{label:{t:0,b:{t:2,i:[{t:3}],s:"Access Password"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"Enter"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"Password"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"Password cannot be empty"}},1:{t:0,b:{t:2,i:[{t:3}],s:"Incorrect password"}},2:{t:0,b:{t:2,i:[{t:3}],s:"Unable to connect to the service"}},3:{t:0,b:{t:2,i:[{t:3}],s:"Verification successful, waiting to load"}},4:{t:0,b:{t:2,i:[{t:3}],s:"Verifying"}},5:{t:0,b:{t:2,i:[{t:3,v:"Too many incorrect password attempts. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},6:{t:0,b:{t:2,i:[{t:3,v:"Try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},7:{t:0,b:{t:2,i:[{t:3,v:"Password verification is being refused. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"Restricted Content"}}}}})}typeof I=="function"&&I(F);const Y={id:"main"},Z={id:"authBox"},ee={id:"mainTitle"},te=k({__name:"AuthSubPage",props:{targetUrlPath:{type:String,required:!0},title:{type:String,default:""},other:{type:Object,default:{}}},setup(d){const a=d,t=c(null);let l=!1;const u=c(null),e=c(null);function i(n){return((n instanceof Date?n:new Date(n)).getTime()-Date.now())/1e3}async function _(n){if(e.value){e.value.showFeedback("alert-secondary",4),e.value.lockInput();{const r=S().get("passwordAuthLockDown_unlockTime");if(r!=null){e.value.showFeedback("alert-danger",6,{timeSec:Math.round(i(r))}),e.value.unlockInput();return}}const s=await J(a.targetUrlPath,{Password:n});if(s.result!=null)if(s.result.ok)e.value.showFeedback("alert-success",3),l=!0,t.value.src=`${s.result.json.url}?passkey=${s.result.json.paras.passkey}`;else if(s.result.statusCode==401)switch(s.result.json.errorId){case 0:e.value.showFeedback("alert-danger",1),e.value.unlockInput();break;case 1:case 2:const r=s.result.json.unlockTime,v=Math.round(i(r));switch(s.result.json.errorId){case 1:e.value.showFeedback("alert-danger",5,{timeSec:v});break;case 2:e.value.showFeedback("alert-danger",7,{timeSec:v});break}e.value.unlockInput(),S().set("passwordAuthLockDown_unlockTime",r,{expires:new Date(r)});break}else e.value.showFeedback("alert-warning",2),e.value.unlockInput();else e.value.showFeedback("alert-warning",2),e.value.unlockInput()}}function f(){t.value&&u.value&&l&&(t.value.style.display="",u.value.style.display="none",a.other.doServerMapFix==!0&&(async()=>{const{sleep:n}=await g(async()=>{const{sleep:r}=await import("./sleep-CijeuSbY.js");return{sleep:r}},[]),s=(await g(async()=>{const{default:r}=await import("./serverMap_fix-myFI28f_.js");return{default:r}},__vite__mapDeps([0,1]))).default;await n(2600),await s()})())}return(n,s)=>(w(),T(D,null,[o("div",Y,[o("iframe",{ref_key:"mainIframe",ref:t,id:"mainIframe",src:"",onload:f,style:{display:"none"},allow:"fullscreen; pointer-lock;",webkitallowfullscreen:"true",mozallowfullscreen:"true"},null,512)]),o("div",{id:"authContainer",ref_key:"authContainer",ref:u},[o("div",Z,[o("h2",ee,b(a.title),1),A(F,{ref_key:"passwordInput",ref:e,onPasswdEnter:_},null,512)])],512)],64))}}),ae=L(te,[["__scopeId","data-v-2d461f46"]]),oe=k({__name:"ReuseParentSubPage",setup(d){const a=M(),t=V(()=>({authSubPage:{targetUrlPath:a.meta.authSubPage_targetUrlPath,doServerMapFix:a.meta.authSubPage_doServerMapFix!=null?a.meta.authSubPage_doServerMapFix:!1},localePrefix:a.meta.localePrefix})),{gt:l}=x(),u=t.value.localePrefix;return q(u,()=>{N(l(`${u}.title`))}),(e,i)=>(w(),K(ae,{targetUrlPath:t.value.authSubPage.targetUrlPath,title:p(l)(`${p(u)}.subTitle`),other:{doServerMapFix:t.value.authSubPage.doServerMapFix}},null,8,["targetUrlPath","title","other"]))}});export{oe as default};
