const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/serverMap_fix-myFI28f_.js","assets/sleep-CijeuSbY.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./app-CIedObnG.js";import{c as U,b as E,a as D,u as A}from"./globalFunc-BgRvxbat.js";import{d as k,f as x,a as c,h as T,j as w,k as l,t as b,u as f,I as L,H as P,q as M,F as V,J as S,n as K,B as O,K as R,p as N,L as z}from"./virtual_svg-icons-register-DjSL9YIa.js";async function q(d,s=void 0){{const t=U();if(t!=null)return t}try{const t=await fetch(`${E}${d}`,{method:"POST",headers:{"X-API-Key":D,"Content-Type":"application/json"},body:JSON.stringify(s||{})});return{code:0,result:{ok:t.ok,json:await t.json(),statusCode:t.status}}}catch{return{code:4}}}const J={class:"card-header d-flex justify-content-center"},H={class:"card-body"},X={class:"input-group"},G={class:"input-group-text"},Q=["placeholder"],F=k({__name:"passwordInput",emits:["passwdEnter"],setup(d,{expose:s,emit:t}){const{lt:o}=x(),u=t,e=c(null),i=c(null),_=c(!1),p=c(null),n=c(null),a=c("alert-secondary");function r(m,h,y=null){n.value&&(y==null?n.value.innerText=o(`feedback.${h}`):n.value.innerText=o(`feedback.${h}`,y),a.value=m,_.value=m=="alert-danger",n.value.style.display="")}function v(){i.value&&(i.value.value!=""?u("passwdEnter",i.value.value):r("alert-danger",0))}function $(){return i.value&&p.value?(i.value.disabled=!0,p.value.disabled=!0,!0):!1}function j(){return i.value&&p.value?(i.value.disabled=!1,p.value.disabled=!1,!0):!1}function C(){return e.value?(e.value.style.display="none",!0):!1}function B(){return e.value?(e.value.style.display="",!0):!1}return s({showFeedback:r,lockInput:$,unlockInput:j,hidePanel:C,unhidePanel:B}),(m,h)=>(w(),T("div",{ref_key:"pswIptPanel",ref:e,class:"card"},[l("div",J,[l("strong",null,b(f(o)("title")),1)]),l("div",H,[l("div",X,[l("span",G,b(f(o)("label")),1),l("input",{ref_key:"passwordInput",ref:i,type:"password",class:P(["form-control",{"is-invalid":_.value}]),placeholder:f(o)("inputText"),onKeyup:L(v,["enter"])},null,42,Q),l("button",{class:"btn btn-outline-secondary",type:"button",ref_key:"enterButton",ref:p,onClick:v},b(f(o)("enterBtn")),513)]),l("div",{ref_key:"feedback",ref:n,class:P(["alert mt-3 mb-0",[a.value]]),role:"alert",style:{display:"none"}},null,2)])],512))}});function I(d){const s=d;s.__i18n=s.__i18n||[],s.__i18n.push({locale:"",resource:{"zh-CN":{label:{t:0,b:{t:2,i:[{t:3}],s:"访问密码"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"进入"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"密码"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"密码不可为空"}},1:{t:0,b:{t:2,i:[{t:3}],s:"密码错误"}},2:{t:0,b:{t:2,i:[{t:3}],s:"无法连接至服务"}},3:{t:0,b:{t:2,i:[{t:3}],s:"验证成功，等待加载"}},4:{t:0,b:{t:2,i:[{t:3}],s:"正在验证"}},5:{t:0,b:{t:2,i:[{t:3,v:"密码错误次数过多，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}},6:{t:0,b:{t:2,i:[{t:4,k:"timeSec"},{t:3,v:"秒后再次尝试"}]}},7:{t:0,b:{t:2,i:[{t:3,v:"当前拒绝密码验证，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"访问限制内容"}}},"en-US":{label:{t:0,b:{t:2,i:[{t:3}],s:"Access Password"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"Enter"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"Password"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"Password cannot be empty"}},1:{t:0,b:{t:2,i:[{t:3}],s:"Incorrect password"}},2:{t:0,b:{t:2,i:[{t:3}],s:"Unable to connect to the service"}},3:{t:0,b:{t:2,i:[{t:3}],s:"Verification successful, waiting to load"}},4:{t:0,b:{t:2,i:[{t:3}],s:"Verifying"}},5:{t:0,b:{t:2,i:[{t:3,v:"Too many incorrect password attempts. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},6:{t:0,b:{t:2,i:[{t:3,v:"Try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},7:{t:0,b:{t:2,i:[{t:3,v:"Password verification is being refused. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"Restricted Content"}}}}})}typeof I=="function"&&I(F);const W={id:"main"},Y={id:"authBox"},Z={id:"mainTitle"},ee=k({__name:"AuthSubPage",props:{targetUrlPath:{type:String,required:!0},title:{type:String,default:""},other:{type:Object,default:{}}},setup(d){const s=d,t=c(null);let o=!1;const u=c(null),e=c(null);function i(n){return((n instanceof Date?n:new Date(n)).getTime()-Date.now())/1e3}async function _(n){if(e.value){e.value.showFeedback("alert-secondary",4),e.value.lockInput();{const r=S().get("passwordAuthLockDown_unlockTime");if(r!=null){e.value.showFeedback("alert-danger",6,{timeSec:Math.round(i(r))}),e.value.unlockInput();return}}const a=await q(s.targetUrlPath,{Password:n});if(a.result!=null)if(a.result.ok)e.value.showFeedback("alert-success",3),o=!0,t.value.src=a.result.json.url.includes("?")?`${a.result.json.url}&passkey=${a.result.json.paras.passkey}`:`${a.result.json.url}?passkey=${a.result.json.paras.passkey}`;else if(a.result.statusCode==401)switch(a.result.json.errorId){case 0:e.value.showFeedback("alert-danger",1),e.value.unlockInput();break;case 1:case 2:const r=a.result.json.unlockTime,v=Math.round(i(r));switch(a.result.json.errorId){case 1:e.value.showFeedback("alert-danger",5,{timeSec:v});break;case 2:e.value.showFeedback("alert-danger",7,{timeSec:v});break}e.value.unlockInput(),S().set("passwordAuthLockDown_unlockTime",r,{expires:new Date(r)});break}else e.value.showFeedback("alert-warning",2),e.value.unlockInput();else e.value.showFeedback("alert-warning",2),e.value.unlockInput()}}function p(){t.value&&u.value&&o&&(t.value.style.display="",u.value.style.display="none",s.other.doServerMapFix==!0&&(async()=>{const{sleep:n}=await g(async()=>{const{sleep:r}=await import("./sleep-CijeuSbY.js");return{sleep:r}},[]),a=(await g(async()=>{const{default:r}=await import("./serverMap_fix-myFI28f_.js");return{default:r}},__vite__mapDeps([0,1]))).default;await n(2600),await a()})())}return(n,a)=>(w(),T(V,null,[l("div",W,[l("iframe",{ref_key:"mainIframe",ref:t,id:"mainIframe",src:"",onload:p,style:{display:"none"},allow:"fullscreen; pointer-lock;",webkitallowfullscreen:"true",mozallowfullscreen:"true"},null,512)]),l("div",{id:"authContainer",ref_key:"authContainer",ref:u},[l("div",Y,[l("h2",Z,b(s.title),1),M(F,{ref_key:"passwordInput",ref:e,onPasswdEnter:_},null,512)])],512)],64))}}),te=K(ee,[["__scopeId","data-v-20ae42f1"]]),re=k({__name:"ReuseParentSubPage",setup(d){const s=O(),t=R(()=>({authSubPage:{targetUrlPath:s.meta.authSubPage_targetUrlPath,doServerMapFix:s.meta.authSubPage_doServerMapFix!=null?s.meta.authSubPage_doServerMapFix:!1},localePrefix:s.meta.localePrefix})),{gt:o}=x(),u=t.value.localePrefix;return N(u,()=>{A(o(`${u}.title`))}),(e,i)=>(w(),z(te,{targetUrlPath:t.value.authSubPage.targetUrlPath,title:f(o)(`${f(u)}.subTitle`),other:{doServerMapFix:t.value.authSubPage.doServerMapFix}},null,8,["targetUrlPath","title","other"]))}});export{re as default};
