const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/serverMap_fix-myFI28f_.js","assets/sleep-CijeuSbY.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./app-B1OCv7HL.js";import{c as $,b as E,a as A,u as D,d as L}from"./urlAddParam-C6k7ji04.js";import{d as k,f as x,a as c,h as T,j as w,k as l,t as b,u as f,I as M,H as P,q as V,F as K,J as S,n as O,B as R,K as N,p as z,L as q}from"./virtual_svg-icons-register-DleCh21g.js";async function J(d,a=void 0){{const t=$();if(t!=null)return t}try{const t=await fetch(`${E}${d}`,{method:"POST",headers:{"X-API-Key":A,"Content-Type":"application/json"},body:JSON.stringify(a||{})});return{code:0,result:{ok:t.ok,json:await t.json(),statusCode:t.status}}}catch{return{code:4}}}const H={class:"card-header d-flex justify-content-center"},X={class:"card-body"},G={class:"input-group"},Q={class:"input-group-text"},W=["placeholder"],F=k({__name:"passwordInput",emits:["passwdEnter"],setup(d,{expose:a,emit:t}){const{lt:o}=x(),i=t,e=c(null),u=c(null),_=c(!1),p=c(null),n=c(null),s=c("alert-secondary");function r(m,h,y=null){n.value&&(y==null?n.value.innerText=o(`feedback.${h}`):n.value.innerText=o(`feedback.${h}`,y),s.value=m,_.value=m=="alert-danger",n.value.style.display="")}function v(){u.value&&(u.value.value!=""?i("passwdEnter",u.value.value):r("alert-danger",0))}function C(){return u.value&&p.value?(u.value.disabled=!0,p.value.disabled=!0,!0):!1}function j(){return u.value&&p.value?(u.value.disabled=!1,p.value.disabled=!1,!0):!1}function B(){return e.value?(e.value.style.display="none",!0):!1}function U(){return e.value?(e.value.style.display="",!0):!1}return a({showFeedback:r,lockInput:C,unlockInput:j,hidePanel:B,unhidePanel:U}),(m,h)=>(w(),T("div",{ref_key:"pswIptPanel",ref:e,class:"card"},[l("div",H,[l("strong",null,b(f(o)("title")),1)]),l("div",X,[l("div",G,[l("span",Q,b(f(o)("label")),1),l("input",{ref_key:"passwordInput",ref:u,type:"password",class:P(["form-control",{"is-invalid":_.value}]),placeholder:f(o)("inputText"),onKeyup:M(v,["enter"])},null,42,W),l("button",{class:"btn btn-outline-secondary",type:"button",ref_key:"enterButton",ref:p,onClick:v},b(f(o)("enterBtn")),513)]),l("div",{ref_key:"feedback",ref:n,class:P(["alert mt-3 mb-0",[s.value]]),role:"alert",style:{display:"none"}},null,2)])],512))}});function I(d){const a=d;a.__i18n=a.__i18n||[],a.__i18n.push({locale:"",resource:{"zh-CN":{label:{t:0,b:{t:2,i:[{t:3}],s:"访问密码"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"进入"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"密码"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"密码不可为空"}},1:{t:0,b:{t:2,i:[{t:3}],s:"密码错误"}},2:{t:0,b:{t:2,i:[{t:3}],s:"无法连接至服务"}},3:{t:0,b:{t:2,i:[{t:3}],s:"验证成功，等待加载"}},4:{t:0,b:{t:2,i:[{t:3}],s:"正在验证"}},5:{t:0,b:{t:2,i:[{t:3,v:"密码错误次数过多，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}},6:{t:0,b:{t:2,i:[{t:4,k:"timeSec"},{t:3,v:"秒后再次尝试"}]}},7:{t:0,b:{t:2,i:[{t:3,v:"当前拒绝密码验证，"},{t:4,k:"timeSec"},{t:3,v:"秒后再试"}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"访问限制内容"}}},"en-US":{label:{t:0,b:{t:2,i:[{t:3}],s:"Access Password"}},enterBtn:{t:0,b:{t:2,i:[{t:3}],s:"Enter"}},inputText:{t:0,b:{t:2,i:[{t:3}],s:"Password"}},feedback:{0:{t:0,b:{t:2,i:[{t:3}],s:"Password cannot be empty"}},1:{t:0,b:{t:2,i:[{t:3}],s:"Incorrect password"}},2:{t:0,b:{t:2,i:[{t:3}],s:"Unable to connect to the service"}},3:{t:0,b:{t:2,i:[{t:3}],s:"Verification successful, waiting to load"}},4:{t:0,b:{t:2,i:[{t:3}],s:"Verifying"}},5:{t:0,b:{t:2,i:[{t:3,v:"Too many incorrect password attempts. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},6:{t:0,b:{t:2,i:[{t:3,v:"Try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}},7:{t:0,b:{t:2,i:[{t:3,v:"Password verification is being refused. Please try again in "},{t:4,k:"timeSec"},{t:3,v:" seconds."}]}}},title:{t:0,b:{t:2,i:[{t:3}],s:"Restricted Content"}}}}})}typeof I=="function"&&I(F);const Y={id:"main"},Z={id:"authBox"},ee={id:"mainTitle"},te=k({__name:"AuthSubPage",props:{targetUrlPath:{type:String,required:!0},title:{type:String,default:""},other:{type:Object,default:{}}},setup(d){const a=d,t=c(null);let o=!1;const i=c(null),e=c(null);function u(n){return((n instanceof Date?n:new Date(n)).getTime()-Date.now())/1e3}async function _(n){if(e.value){e.value.showFeedback("alert-secondary",4),e.value.lockInput();{const r=S().get("passwordAuthLockDown_unlockTime");if(r!=null){e.value.showFeedback("alert-danger",6,{timeSec:Math.round(u(r))}),e.value.unlockInput();return}}const s=await J(a.targetUrlPath,{Password:n});if(s.result!=null)if(s.result.ok)e.value.showFeedback("alert-success",3),o=!0,t.value.src=D(s.result.json.url,{params:[{name:"passkey",value:s.result.json.paras.passkey},{name:"source",value:s.result.json.paras.source}]});else if(s.result.statusCode==401)switch(s.result.json.errorId){case 0:e.value.showFeedback("alert-danger",1),e.value.unlockInput();break;case 1:case 2:const r=s.result.json.unlockTime,v=Math.round(u(r));switch(s.result.json.errorId){case 1:e.value.showFeedback("alert-danger",5,{timeSec:v});break;case 2:e.value.showFeedback("alert-danger",7,{timeSec:v});break}e.value.unlockInput(),S().set("passwordAuthLockDown_unlockTime",r,{expires:new Date(r)});break}else e.value.showFeedback("alert-warning",2),e.value.unlockInput();else e.value.showFeedback("alert-warning",2),e.value.unlockInput()}}function p(){t.value&&i.value&&o&&(t.value.style.display="",i.value.style.display="none",a.other.doServerMapFix==!0&&(async()=>{const{sleep:n}=await g(async()=>{const{sleep:r}=await import("./sleep-CijeuSbY.js");return{sleep:r}},[]),s=(await g(async()=>{const{default:r}=await import("./serverMap_fix-myFI28f_.js");return{default:r}},__vite__mapDeps([0,1]))).default;await n(2600),await s()})())}return(n,s)=>(w(),T(K,null,[l("div",Y,[l("iframe",{ref_key:"mainIframe",ref:t,id:"mainIframe",src:"",onload:p,style:{display:"none"},allow:"fullscreen; pointer-lock;",webkitallowfullscreen:"true",mozallowfullscreen:"true"},null,512)]),l("div",{id:"authContainer",ref_key:"authContainer",ref:i},[l("div",Z,[l("h2",ee,b(a.title),1),V(F,{ref_key:"passwordInput",ref:e,onPasswdEnter:_},null,512)])],512)],64))}}),ae=O(te,[["__scopeId","data-v-767649d3"]]),le=k({__name:"ReuseParentSubPage",setup(d){const a=R(),t=N(()=>({authSubPage:{targetUrlPath:a.meta.authSubPage_targetUrlPath,doServerMapFix:a.meta.authSubPage_doServerMapFix!=null?a.meta.authSubPage_doServerMapFix:!1},localePrefix:a.meta.localePrefix})),{gt:o}=x(),i=t.value.localePrefix;return z(i,()=>{L(o(`${i}.title`))}),(e,u)=>(w(),q(ae,{targetUrlPath:t.value.authSubPage.targetUrlPath,title:f(o)(`${f(i)}.subTitle`),other:{doServerMapFix:t.value.authSubPage.doServerMapFix}},null,8,["targetUrlPath","title","other"]))}});export{le as default};
